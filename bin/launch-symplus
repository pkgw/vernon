#!/bin/bash
#
# This was originally for launching Symphony, but I don't use symphony
# anymore. The framework is still handy for launching Faraday coefficient
# calculations with my Python code.

if [ "$1" = test ] ; then
    array_spec=0-1
    time_lim=1
    partition=interact
    set -x
elif [ "$1" = prod ] ; then
    array_spec=0-1023
    time_lim=60
    partition=serial_requeue
elif [ "$1" = med ] ; then
    array_spec=0-128
    time_lim=10
    partition=serial_requeue
else
    echo >&2 "first argument must be either \"test\" or \"prod\" or \"med\""
    exit 1
fi

case "$2" in
    powerlaw|pitchy|pitchy-jv|plfaraday|pitchy-f) ;;
    *)
	echo >&2 "distribution type \"$2\" not recognized"
	exit 1 ;;
esac

exec sbatch \
    -a $array_spec \
    -o '%A.out' \
    -J symphony \
    --mem=512 \
    -N 1 \
    -n 1 \
    -p $partition \
    -t $time_lim \
    -o '%A.log' \
    --open-mode=append \
    $(cd $(dirname $0)/../modeling && pwd)/symplus_run_odyssey.sh "$2" $(cd $(dirname $0)/../neurosynchro && pwd)
